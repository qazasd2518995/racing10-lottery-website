# 輸贏控制系統手動測試指南

## 🎯 測試目的
驗證輸贏控制系統的四種模式和不同機率比例控制是否正確實現。

## 📋 測試環境
- **管理端**: http://localhost:3003
- **遊戲端**: http://localhost:3000
- **測試帳號**: 
  - 管理員: ti2025A / ti2025A
  - 會員: titi / titi123 (或其他現有會員)

## 🔧 測試準備

### 1. 啟動服務
```bash
# 啟動代理管理系統
node agentBackend.js

# 啟動遊戲後端
node backend.js

# 啟動遊戲前端
npm start
```

### 2. 登錄管理端
1. 打開 http://localhost:3003
2. 使用 ti2025A / ti2025A 登錄
3. 點擊「客服功能」標籤
4. 選擇「輸贏控制」子標籤

## 🎮 詳細測試步驟

### 測試案例 1: 單會員贏控制 (90%機率)

#### 設定步驟：
1. 在輸贏控制界面點擊「新增控制」
2. 填寫以下設定：
   - **控制模式**: single_member (單會員控制)
   - **目標類型**: member (會員)
   - **目標用戶**: 選擇 titi
   - **控制機率**: 90%
   - **控制類型**: ☑️ 贏控制 ☐ 輸控制
   - **開始期數**: 使用建議期數或手動輸入
3. 點擊「創建」按鈕
4. 在控制列表中點擊「激活」按鈕

#### 測試步驟：
1. 打開遊戲前端 http://localhost:3000
2. 使用會員帳號 titi 登錄
3. 連續下注5-10輪，每輪下注100元在相同號碼上
4. 觀察開獎結果：應該有約90%的機率中獎

#### 預期結果：
- ✅ 會員 titi 的中獎率應接近90%
- ✅ 其他會員不受影響
- ✅ 管理端可正常查看控制狀態

### 測試案例 2: 單會員輸控制 (10%機率)

#### 設定步驟：
1. 先停用之前的控制設定
2. 創建新控制設定：
   - **控制模式**: single_member
   - **目標用戶**: titi
   - **控制機率**: 10%
   - **控制類型**: ☐ 贏控制 ☑️ 輸控制

#### 測試步驟：
1. 繼續使用會員 titi 下注
2. 連續下注5-10輪
3. 觀察開獎結果：應該只有約10%的機率中獎

#### 預期結果：
- ✅ 會員 titi 的中獎率應接近10%
- ✅ 輸控制正確生效

### 測試案例 3: 代理線控制 (70%機率)

#### 設定步驟：
1. 創建代理線控制：
   - **控制模式**: agent_line (代理線控制)
   - **目標類型**: agent (代理)
   - **目標用戶**: 選擇一個有下級會員的代理
   - **控制機率**: 70%
   - **控制類型**: ☑️ 贏控制

#### 測試步驟：
1. 使用該代理線下的多個會員帳號登錄遊戲
2. 讓這些會員同時下注
3. 觀察整條代理線的中獎情況

#### 預期結果：
- ✅ 該代理線下所有會員的整體中獎率約70%
- ✅ 其他代理線不受影響

### 測試案例 4: 自動偵測控制 (30%機率)

#### 設定步驟：
1. 創建自動偵測控制：
   - **控制模式**: auto_detect (自動偵測)
   - **目標類型**: 留空
   - **控制機率**: 30%
   - **控制類型**: ☐ 贏控制 ☑️ 輸控制

#### 測試步驟：
1. 讓多個會員在同一期大額下注（單筆超過1000元）
2. 觀察系統是否自動偵測並觸發控制
3. 查看開獎結果是否符合設定

#### 預期結果：
- ✅ 大額下注時自動觸發控制
- ✅ 中獎率約30%（輸控制）
- ✅ 小額下注時不觸發控制

## 🔍 機率驗證方法

### 統計驗證：
1. **短期測試** (10輪)：允許±20%的誤差
2. **中期測試** (50輪)：允許±10%的誤差  
3. **長期測試** (100輪)：允許±5%的誤差

### 記錄格式：
```
測試輪數 | 設定機率 | 實際中獎次數 | 實際機率 | 誤差
10輪    | 90%     | 8次         | 80%     | -10%
50輪    | 90%     | 47次        | 94%     | +4%
```

## ⚠️ 注意事項

### 測試時機：
- 確保測試期間沒有其他會員大量下注
- 控制設定需要在期數開始前設置
- 每個測試案例之間要清理之前的控制設定

### 故障排除：
1. **控制不生效**：檢查開始期數是否正確
2. **機率偏差很大**：增加測試輪數
3. **API錯誤**：檢查服務器日誌
4. **權限錯誤**：確認使用總代理帳號登錄

## 📊 測試報告模板

```
=== 輸贏控制系統測試報告 ===

測試日期: [填寫日期]
測試人員: [填寫姓名]
測試環境: [本地/生產]

--- 單會員贏控制測試 ---
設定機率: 90%
測試輪數: [輪數]
實際中獎: [次數]
實際機率: [百分比]
結果: [通過/失敗]

--- 單會員輸控制測試 ---
設定機率: 10%
測試輪數: [輪數]
實際中獎: [次數]
實際機率: [百分比]
結果: [通過/失敗]

--- 代理線控制測試 ---
設定機率: 70%
測試輪數: [輪數]
實際中獎: [次數]
實際機率: [百分比]
結果: [通過/失敗]

--- 自動偵測控制測試 ---
設定機率: 30%
大額下注觸發: [是/否]
測試輪數: [輪數]
實際中獎: [次數]
實際機率: [百分比]
結果: [通過/失敗]

--- 總結 ---
整體測試結果: [通過/失敗]
發現問題: [列出問題]
改進建議: [列出建議]
```

## 🎯 成功標準

✅ **功能正確性**：
- 所有控制模式都能正確創建和激活
- 機率控制在合理誤差範圍內
- 不同控制類型互不干擾

✅ **界面可用性**：
- 管理界面操作流暢
- 控制狀態顯示正確
- 錯誤信息清晰明確

✅ **系統穩定性**：
- 長時間運行無錯誤
- 高並發下注時穩定
- 控制切換無異常

---

💡 **建議測試順序**：單會員控制 → 代理線控制 → 自動偵測控制
🔧 **問題回報**：請記錄所有異常情況和錯誤日誌
📈 **持續改進**：根據測試結果調整機率算法和控制邏輯
