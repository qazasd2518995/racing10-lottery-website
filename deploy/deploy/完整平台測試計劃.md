# 🧪 完整平台測試計劃

## 測試環境
- **遊戲平台**: https://bet-game-vcje.onrender.com
- **代理平台**: https://bet-agent.onrender.com
- **資料庫**: PostgreSQL (Render部署)

## 測試賬號準備

### 總代理賬號
- **A盤總代理**: ti2025A (退水上限: 1.1%)
- **D盤總代理**: ti2025D (退水上限: 4.1%)

## 📋 測試項目清單

### ✅ 測試1: 創建15層代理結構
**目標**: 驗證代理層級創建功能和層級限制

**A盤代理結構**:
```
ti2025A (L1, 1.1%)
  └── agentA2_xxx (L2, 1.05%, 比例模式)
      └── agentA3_xxx (L3, 0.99%, 全拿模式)
          └── agentA4_xxx (L4, 0.94%, 比例模式)
              └── ... 繼續到 L15
```

**D盤代理結構**:
```
ti2025D (L1, 4.1%)
  └── agentD2_xxx (L2, 3.90%, 比例模式)
      └── agentD3_xxx (L3, 3.69%, 全拿模式)
          └── agentD4_xxx (L4, 3.49%, 比例模式)
              └── ... 繼續到 L15
```

**驗證點**:
- ✓ 每層代理成功創建
- ✓ 退水比例逐層遞減
- ✓ 退水模式正確設置
- ✓ 第16層無法創建（達到限制）

### ✅ 測試2: 創建會員功能
**目標**: 驗證不同層級代理創建會員的功能

**測試會員**:
- L2代理的會員 × 2
- L6代理的會員 × 2
- L15代理的會員 × 2

**驗證點**:
- ✓ 會員繼承代理的盤口類型
- ✓ 會員退水比例正確設置
- ✓ 會員與代理關聯正確

### ✅ 測試3: 登入測試
**目標**: 驗證所有賬號可以正常登入

**測試內容**:
1. 代理登入代理平台
2. 會員登入遊戲平台
3. 錯誤密碼測試
4. 跨平台登入限制

### ✅ 測試4-5: 下注和賠率測試
**目標**: 驗證不同盤口的賠率差異和下注功能

**A盤預期賠率**:
- 號碼: 9.89
- 兩面: 1.9

**D盤預期賠率**:
- 號碼: 9.59
- 兩面: 1.88

**測試下注類型**:
1. 冠軍大/小
2. 亞軍單/雙
3. 號碼投注
4. 龍虎對戰
5. 冠亞和值

### ✅ 測試6: 退水計算驗證
**目標**: 驗證退水按照我們修復的邏輯正確計算

**測試案例**:
- A盤L2代理(1.05%)的會員下注100元 → 退水1.05元
- D盤L6代理(3.28%)的會員下注200元 → 退水6.56元

**驗證點**:
- ✓ 退水金額 = 下注金額 × 代理設置的退水比例
- ✓ 不再是錯誤的乘法運算
- ✓ 退水正確分配給代理

### ✅ 測試7: 代理儀表板
**目標**: 驗證儀表板數據準確性

**檢查項目**:
- 會員總數
- 下級代理數
- 今日投注額
- 今日盈虧
- 總餘額
- 實時數據更新

### ✅ 測試8: 登錄日誌
**目標**: 驗證登錄日誌記錄功能

**測試內容**:
- 登錄時間記錄
- IP地址記錄
- 設備信息記錄
- 登錄狀態（成功/失敗）

### ✅ 測試9: 報表查詢
**目標**: 驗證報表數據完整性和準確性

**測試報表**:
1. 代理層級分析
2. 會員輸贏報表
3. 交易明細報表
4. 盈虧統計報表

**驗證點**:
- ✓ 所有下注記錄都出現在報表中
- ✓ 金額計算正確
- ✓ 退水顯示正確

### ✅ 測試10: 交易記錄
**目標**: 測試各種交易類型的記錄

**測試交易類型**:
1. **存款測試**: 代理給會員存款
2. **提款測試**: 會員向代理提款
3. **退水記錄**: 自動退水分配
4. **點數轉移**: 代理間轉賬

### ✅ 測試11: 下注記錄
**目標**: 驗證下注記錄的完整性

**檢查內容**:
- 下注時間
- 下注類型和金額
- 賠率記錄
- 開獎結果
- 輸贏金額
- 退水金額

### ✅ 測試12: 客服功能
**目標**: 測試客服調整餘額功能

**測試內容**:
1. 客服給代理加錢
2. 客服給會員加錢
3. 客服扣減餘額
4. 交易記錄生成

### ✅ 測試13: 隱私性測試
**目標**: 驗證數據隔離和權限控制

**測試場景**:
1. **L5代理登入**:
   - ✓ 能看到L6-L15的下級代理
   - ✗ 不能看到L1-L4的上級代理
   - ✓ 只能看到自己線下的會員

2. **跨線檢查**:
   - ✗ A盤代理看不到D盤數據
   - ✗ 不同線的代理互相看不到

3. **數據權限**:
   - ✗ 不能修改上級代理數據
   - ✓ 只能管理自己的下級

## 📊 預期測試結果

### 數據統計
- A盤代理: 14個（L2-L15）
- D盤代理: 14個（L2-L15）
- A盤會員: 6個
- D盤會員: 6個
- 總下注數: 約30-40筆
- 交易記錄: 約20-30筆

### 關鍵驗證點
1. **退水機制**: 確認按照代理設置比例直接計算
2. **賠率差異**: A盤高賠率 vs D盤標準賠率
3. **層級限制**: 最多15層代理
4. **數據隔離**: 不同線路數據完全隔離

## 🚀 執行測試

運行測試腳本：
```bash
node run-comprehensive-test.js
```

測試將自動執行所有13個測試項目，並生成詳細的測試報告。

## ⚠️ 注意事項

1. 測試前確保平台正常運行
2. 準備好總代理的登入憑證
3. 測試會創建大量測試數據
4. 建議在測試環境執行，避免影響生產數據
5. 測試完成後可能需要清理測試數據 