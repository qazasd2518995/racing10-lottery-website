# 報表查詢功能使用說明

## 功能概述

報表查詢功能是代理管理平台的重要組成部分，位於「會員管理」右側的導航選項中。此功能提供全面的投注數據分析和報表生成能力，幫助代理高效管理和分析其業務數據。

## 主要功能特點

### 1. 多維度查詢條件
- **時間範圍篩選**：支援自定義日期範圍和快速時間選項
- **遊戲類型篩選**：支援各種遊戲類型的組合篩選
- **結算狀態篩選**：已結算、未結算、全部狀態
- **投注類型篩選**：單號投注、組合投注
- **金額範圍篩選**：最小金額至最大金額
- **用戶篩選**：支援會員名或代理名搜索

### 2. 統計摘要顯示
- **總投注筆數**：藍色卡片顯示投注總數
- **總投注金額**：天藍色卡片顯示投注總額
- **有效投注**：綠色卡片顯示有效投注金額
- **盈虧結果**：動態顏色卡片（綠色盈利/紅色虧損）

### 3. 詳細報表數據
包含13個欄位的完整報表：
- 期號、用戶名、遊戲類型
- 投注內容、下注金額、有效金額
- 盈虧、退水、所屬代理
- 佔成、代理結果、上交、時間

### 4. 數據匯出功能
- 支援Excel格式報表匯出
- 自動生成包含時間範圍的檔案名稱
- 保持與查詢條件一致的數據篩選

## 使用方法

### 1. 進入報表查詢頁面
1. 登入代理管理平台
2. 點擊導航選單中的「📊報表查詢」選項
3. 系統自動載入今日報表數據

### 2. 設定查詢條件

#### 時間範圍設定
- **手動設定**：選擇開始日期和結束日期
- **快速選項**：
  - 今日：當天數據
  - 昨日：前一天數據
  - 本週：本週一至今日
  - 本月：本月1日至今日

#### 遊戲類型篩選
- 全選：包含所有遊戲類型
- 個別選擇：
  - AR PK10
  - AR 時時彩
  - AR 539
  - AR 六合彩
  - 其他遊戲

#### 結算狀態篩選
- 全部：所有投注記錄
- 已結算：已開獎結算的投注
- 未結算：等待開獎的投注

#### 投注類型篩選
- 全部：所有投注類型
- 單號投注：單一號碼投注
- 組合投注：多號碼組合投注

#### 金額範圍篩選
- 輸入最小金額和最大金額
- 留空表示不限制該範圍

#### 用戶篩選
- 輸入會員用戶名或代理用戶名
- 支援模糊搜索

### 3. 執行查詢
1. 設定完查詢條件後，點擊「🔍查詢」按鈕
2. 系統自動更新統計摘要和報表數據
3. 可使用「🔄刷新」按鈕重新載入數據

### 4. 匯出報表
1. 點擊「📥匯出報表」按鈕
2. 系統生成Excel檔案並自動下載
3. 檔案名格式：`報表_開始日期_結束日期.xlsx`

## 界面設計說明

### 1. 頁面佈局
- **頂部操作區**：標題和匯出、查詢按鈕
- **查詢條件區**：折疊式查詢表單
- **統計摘要區**：四個統計卡片
- **報表數據區**：詳細數據表格

### 2. 顏色設計
- **主色調**：藍色系（Bootstrap primary）
- **統計卡片**：
  - 投注筆數：藍色 (bg-primary)
  - 投注金額：天藍色 (bg-info)
  - 有效投注：綠色 (bg-success)
  - 盈虧結果：動態（綠色盈利/紅色虧損）

### 3. 圖標設計
- 📊 報表查詢：主功能圖標
- 🔍 查詢：搜索功能
- 📥 匯出報表：下載功能
- 🔄 刷新：重新載入
- 📅 日曆：時間選擇
- 🎮 遊戲：遊戲類型

## 數據格式說明

### 1. 金額顯示
- 格式：$X,XXX.XX
- 盈利：+$X,XXX.XX（綠色）
- 虧損：-$X,XXX.XX（紅色）

### 2. 百分比顯示
- 格式：XX.X%
- 用於退水比例和佔成顯示

### 3. 日期時間格式
- 日期：YYYY-MM-DD
- 時間：YYYY-MM-DD HH:mm:ss

### 4. 投注內容格式
- 位置投注：位置投注: 大小單雙
- 號碼投注：號碼投注: 1, 5, 8
- 其他類型：根據具體投注內容顯示

## 後端API需求

### 1. 查詢API端點
```
GET /api/agent/reports
```

### 2. 查詢參數
- startDate: 開始日期
- endDate: 結束日期
- gameTypes: 遊戲類型（逗號分隔）
- settlementStatus: 結算狀態
- betType: 投注類型
- minAmount: 最小金額
- maxAmount: 最大金額
- username: 用戶名

### 3. 匯出API端點
```
GET /api/agent/reports/export
```

### 4. 回應數據格式
```javascript
{
  totalBets: 總投注筆數,
  totalAmount: 總投注金額,
  validAmount: 有效投注金額,
  profitLoss: 盈虧結果,
  records: [
    {
      id: 記錄ID,
      period: 期號,
      username: 用戶名,
      game_type: 遊戲類型,
      bet_content: 投注內容,
      amount: 下注金額,
      valid_amount: 有效金額,
      profit_loss: 盈虧,
      rebate: 退水,
      agent_name: 所屬代理,
      commission_rate: 佔成比例,
      agent_result: 代理結果,
      upper_transfer: 上交金額,
      created_at: 創建時間
    }
  ]
}
```

## 注意事項

### 1. 權限控制
- 代理只能查看自己管理範圍內的數據
- 下級代理和會員的投注記錄
- 總代理可查看所有數據

### 2. 性能優化
- 大數據量查詢可能需要較長時間
- 建議使用適當的時間範圍篩選
- 避免查詢過大的日期範圍

### 3. 數據準確性
- 統計數據基於實時資料庫
- 未結算投注的盈虧為預估值
- 最終數據以結算後為準

### 4. 匯出限制
- 單次匯出建議不超過10萬筆記錄
- 大量數據可分批匯出
- 匯出檔案建議定期清理

## 疑難排解

### 1. 查詢無結果
- 檢查時間範圍是否正確
- 確認篩選條件是否過於嚴格
- 驗證用戶名拼寫是否正確

### 2. 匯出失敗
- 檢查網路連接狀態
- 確認數據量是否過大
- 嘗試縮小查詢範圍

### 3. 數據顯示異常
- 刷新頁面重新載入
- 檢查登入狀態是否有效
- 聯繫技術支援

## 更新日誌

### 版本 1.0 (2025-06-27)
- 初始版本發布
- 完整的查詢和篩選功能
- 統計摘要和詳細報表
- Excel匯出功能
- 響應式界面設計

---

**技術支援**：如遇任何問題，請聯繫系統管理員或技術支援團隊。 