# 登錄日誌功能使用說明

## 功能概述

登錄日誌功能提供完整的用戶登錄記錄查詢和管理，包含詳細的時間、IP地址和地理位置信息，幫助代理監控下級帳號的登錄活動。

## 功能特點

- **智能時間篩選**：支援自定義日期範圍和快速選項（今日/昨日/本週/最近7天）
- **多維度查詢**：按用戶名、時間範圍、IP地址等條件篩選
- **詳細記錄**：顯示登錄時間、IP地址、地理位置、用戶類型等信息
- **數據保留**：最少保留7天，超過7天部分保留最後20筆記錄
- **分頁顯示**：支援大量數據的分頁瀏覽
- **實時刷新**：支援手動刷新獲取最新登錄記錄

## 界面組成

### 1. 導航選項
- 位置：儀表板選單右側
- 圖標：📊 登錄日誌
- 功能：點擊進入登錄日誌管理頁面

### 2. 時間範圍選擇器
```
請選擇起止時間
├── 開始時間（日期選擇器）
├── 結束時間（日期選擇器）  
├── 用戶篩選（搜索框）
└── 快速選項（今日/昨日/本週/最近7天）
```

### 3. 登錄記錄表格
包含以下欄位：
- **NO.**：序號
- **用戶名**：登錄的用戶帳號
- **登錄時間**：具體的登錄日期和時間
- **IP**：登錄的IP地址
- **IP歸屬地**：IP地址的地理位置信息

## 使用方法

### 基本查詢
1. 進入「登錄日誌」頁面
2. 系統自動載入最近7天的登錄記錄
3. 查看用戶登錄活動詳情

### 自定義時間查詢
1. 設定「開始時間」和「結束時間」
2. 點擊「搜索」按鈕或按Enter鍵
3. 系統顯示指定時間範圍內的登錄記錄

### 快速時間篩選
- **今日**：查看今天的登錄記錄
- **昨日**：查看昨天的登錄記錄
- **本週**：查看本週的登錄記錄
- **最近7天**：查看最近7天的登錄記錄

### 用戶篩選
1. 在「用戶篩選」輸入框中輸入用戶名
2. 支援模糊搜索
3. 點擊搜索按鈕查看特定用戶的登錄記錄

### 數據刷新
- 點擊「🔄 刷新日誌」按鈕
- 獲取最新的登錄記錄
- 保持數據同步

## 界面設計

### 頁面標題
```
📊 登錄日誌                                    🔄 刷新日誌
```

### 篩選卡片
```
📅 請選擇起止時間
┌─────────────────────────────────────────────────────────┐
│ 開始時間: [____] 結束時間: [____] 用戶篩選: [____] [🔍]  │
│ [今日] [昨日] [本週] [最近7天]                          │
└─────────────────────────────────────────────────────────┘
```

### 記錄表格
```
📋 登錄記錄                                       共 X 筆記錄
┌────┬──────────┬─────────────────┬───────────────┬─────────────┐
│NO. │ 用戶名    │ 登錄時間         │ IP            │ IP歸屬地    │
├────┼──────────┼─────────────────┼───────────────┼─────────────┤
│ 1  │ ttpp123  │ 2025-06-27      │ 123.193.88.143│ 台湾省台北市│
│    │ 👤 會員   │ 10:14:10        │               │ 亚太电信... │
└────┴──────────┴─────────────────┴───────────────┴─────────────┘
```

### 分頁控制
```
顯示第 1 - 20 筆，共 X 筆記錄      ◀ [1] [2] [3] ... ▶
```

## 數據格式

### 登錄記錄字段
```javascript
{
    id: 1,                           // 記錄ID
    username: "ttpp123",             // 用戶名
    user_type: "member",             // 用戶類型（member/agent/admin）
    login_time: "2025-06-27 10:14:10", // 登錄時間
    ip_address: "123.193.88.143",    // IP地址
    ip_location: "台湾省台北市 亚太电信集团公司" // IP歸屬地
}
```

### 用戶類型標識
- **會員**：藍色標籤
- **代理**：綠色標籤  
- **管理員**：紅色標籤

## 後端API需求

### 1. 登錄日誌查詢API
```
GET /api/agent/login-logs
```

**請求參數：**
```javascript
{
    startDate: "2025-01-01",     // 開始日期
    endDate: "2025-01-31",       // 結束日期
    username: "ttpp123"          // 用戶名（可選）
}
```

**響應格式：**
```javascript
{
    "success": true,
    "logs": [
        {
            "id": 1,
            "username": "ttpp123",
            "user_type": "member",
            "login_time": "2025-06-27 10:14:10",
            "ip_address": "123.193.88.143",
            "ip_location": "台湾省台北市 亚太电信集团公司"
        }
    ],
    "total": 100
}
```

### 2. 數據保留策略
- 最少保留7天的完整記錄
- 超過7天的記錄最多保留最後20筆
- 實施自動清理機制

## 安全性考量

### 1. 權限控制
- 代理只能查看下級代理和會員的登錄記錄
- 會員無法查看登錄日誌
- 總代理可以查看所有記錄

### 2. 數據隱私
- IP地址顯示需要適當權限
- 地理位置信息脫敏處理
- 敏感數據加密存儲

### 3. 異常檢測
- 異常IP登錄提醒
- 多地點同時登錄警告
- 頻繁登錄行為監控

## 注意事項

1. **數據保留期限**：登錄日誌最少被保留7天，超過7天部分最多保留最後20筆
2. **查詢範圍限制**：單次查詢最多支援31天範圍
3. **性能考量**：大量數據查詢可能需要稍等片刻
4. **時區問題**：所有時間以系統時區為準
5. **權限限制**：只能查看有權限的用戶登錄記錄

## 疑難排解

### 常見問題

**Q: 為什麼看不到某些用戶的登錄記錄？**
A: 檢查用戶權限，只能查看下級代理和會員的記錄。

**Q: 登錄時間顯示不正確？**
A: 確認系統時區設定，時間以伺服器時區為準。

**Q: IP歸屬地顯示「未知位置」？**
A: 可能是內網IP或IP庫未包含該地址。

**Q: 搜索結果為空？**
A: 檢查時間範圍和用戶名拼寫，確認該期間內有登錄活動。

### 技術支援

如遇到功能問題，請聯繫技術支援並提供：
1. 具體的錯誤訊息
2. 操作步驟描述
3. 查詢的時間範圍
4. 用戶權限等級

---

*登錄日誌功能為代理管理系統的重要安全監控工具，請合理使用並遵守相關法規。* 